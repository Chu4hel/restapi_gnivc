# API для Чеков

Это FastAPI-приложение для управления чеками, пользователями, организациями и накладными.

## Основные возможности

- Создание, чтение, обновление и удаление чеков, пользователей, организаций и накладных.
- Связывание чеков с накладными.
- Аналитика продаж по организациям.
- Поиск чеков по пользователю за определенный период.
- Анализ товаров/услуг по категориям.

## Технологии

- **FastAPI:** Современный, быстрый (высокопроизводительный) веб-фреймворк для создания API.
- **PostgreSQL:** Мощная, объектно-реляционная система баз данных с открытым исходным кодом.
- **SQLAlchemy:** SQL-инструментарий и ORM для Python.
- **Alembic:** Инструмент для миграции баз данных для SQLAlchemy.
- **Docker & Docker Compose:** Для контейнеризации и управления средой разработки.

## Настройка и запуск

### 1. Клонируйте репозиторий

```bash
git clone <URL репозитория>
cd <название папки>
```

### 2. Создайте файл `.env`

Создайте файл `.env` в корневой директории проекта и скопируйте в него содержимое файла `.env.example` (если он есть)
или заполните его следующими переменными:

```
# PostgreSQL
POSTGRES_SERVER=db
POSTGRES_USER=myuser
POSTGRES_PASSWORD=mypassword
POSTGRES_DB=receipts_db
POSTGRES_PORT=5432
```

### 3. Запустите приложение с помощью Docker Compose

```bash
docker-compose up -d --build
```

Эта команда соберет и запустит контейнеры с приложением и базой данных в фоновом режиме.

### 4. Примените миграции базы данных

После запуска контейнеров вам нужно применить миграции базы данных. Для этого выполните следующую команду:

```bash
docker-compose exec api alembic upgrade head
```

### 5. Заполните базу данных тестовыми данными (опционально)

Вы можете заполнить базу данных тестовыми данными, выполнив следующий скрипт:

```bash
docker-compose exec api python -m scripts.populate_db
```

## Документация API

Интерактивная документация API доступна после запуска приложения:

- **Swagger UI:** [http://localhost:8000/docs](http://localhost:8000/docs)
- **ReDoc:** [http://localhost:8000/redoc](http://localhost:8000/redoc)

## Основные эндпоинты API

### Чеки

- `GET /api/v1/checks/`: Получить список чеков.
- `GET /api/v1/checks/{check_id}`: Получить чек по ID.
- `GET /api/v1/checks/{check_id}/full`: Получить полную информацию о чеке.
- `POST /api/v1/checks/`: Создать новый чек.
- `POST /api/v1/checks/{check_id}/invoices/{invoice_id}`: Связать чек с накладной.

### Пользователи

- `GET /api/v1/users/`: Получить список пользователей.
- `GET /api/v1/users/{user_id}`: Получить пользователя по ID.
- `POST /api/v1/users/`: Создать нового пользователя.

### Организации

- `GET /api/v1/organizations/`: Получить список организаций.
- `GET /api/v1/organizations/{org_id}`: Получить организацию по ID.
- `POST /api/v1/organizations/`: Создать новую организацию.

### Накладные

- `GET /api/v1/invoices/`: Получить список накладных.
- `GET /api/v1/invoices/{invoice_id}`: Получить накладную по ID.
- `GET /api/v1/invoices/{invoice_id}/checks`: Получить накладную с привязанными чеками.
- `POST /api/v1/invoices/`: Создать новую накладную.

### Аналитика

- `GET /api/v1/analysis/sales_by_organization`: Анализ продаж по организациям.
- `GET /api/v1/users/{user_id}/checks_by_date`: Поиск чеков по пользователю за период.
- `GET /api/v1/analysis/items_by_category`: Анализ товаров/услуг по категориям.